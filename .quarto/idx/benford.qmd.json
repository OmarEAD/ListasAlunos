{"title":"Benford","markdown":{"yaml":{"title":"Benford","author":"Omar C N Pereira","categories":["R","Lei de Benford","Juros compostos"],"tags":["Benford","Crescimento exponencial","Juros compostos","Fraudes"]},"headingText":"library(tidyverse)","containsRefs":false,"markdown":"\n\n```{r setup, include=FALSE}\nknitr::opts_chunk$set(#collapse = TRUE,\n                      echo = TRUE, \n                      size = \"footnotesize\",\n                      comment = NA,\n                      warning = FALSE,\n                      message = FALSE,\n                      #out.width = \"1\\\\linewidth\",\n                      fig.align = \"center\",\n                      fig.width = 8, \n                      fig.height = 4, \n                      fig.show = \"hold\",\n                      #fig.path = \"Figuras1/\",\n                      fig.pos = \"!htb\",\n                      fig.cap = TRUE,\n                      background = \"#E6E6FA\",\n                      #background = \"black\",\n                      dev = c(\"png\",'pdf'),\n                      res=300,\n                      dpi = 300)\n```\n\n```{r library, echo=FALSE,results='hide'}\n#library(tinytex)\nlibrary(knitr)\nlibrary(kableExtra)\nlibrary(xtable)\nlibrary(ggplot2)\nlibrary(dplyr)\n```\n\n# O que é a lei de Benford[^1]\n\n[^1]: Caso encontre erros, queira fazer comentários, ou trocar uma ideia sobre o artigo, por favor, me escreva: omarcnpereiraead\\@gmail.com\n\nA lei de Benford também é conhecida como a lei do primeiro dígito. A partir dos dados de uma variável podemos extrair todos os seus primeiros dígitos significativos. Por exemplo, o primeiro dígito significativo de $\\pi$ é 3, e de 0.065 é 6. Então, podemos calcular a frequência dos dígitos de 1 a 9.\n\nSeja o conjunto de dados com 10 valores abaixo:\n\n```{r}\nset.seed(1)\nx <- rnorm(10,500,200)\nx\n```\n\nOs primeiros dígitos desses valores são 3, 5, 3, 8, 5, 3, 5, 6, 6 e 4, e a frequência com que eles apareceram no conjunto de dados foi:\n\n```{r}\nx1 <- c(3, 5, 3, 8, 5, 3, 5, 6, 6, 4)\ntable(x1)\n```\n\nOu seja, os valores 4 e 8 apareceram uma única vez, o 6 duas vezes, e os 3 e 5 ocorreram três vezes.\n\nSerá que existe algum padrão na distribuição das frequências dos primeiros dígitos de um conjunto de dados que ocorre naturalmente? Podemos pensar que todos os dígitos, de 1 a 9 deveriam ter a mesma frequência. Mas essa homogeneidade esperada não ocorre e, além disso, parece existir um padrão. Muitos conjuntos de dados, inclusive dados contábeis e econômicos, mostram que o dígito 1 é aquele que mais aparece. em torno de 30%.\n\nA Lei de Benford diz que a frequência relativa dos primeiros dígitos significativos deve ser conforme mostrado na @tbl-ben1.\n\n```{r echo=FALSE, results='hide'}\nw <- 1:9\nround(log10(1+1/w),4)\n```\n\n```{r ben1, echo=FALSE,  fig.pos=\"!H\",out.extra = \"\", results='asis', fig.cap=\"\"}\n#| label: tbl-ben1\n#| tbl-cap-location: top\n#| tbl-cap: \"Frequência da Lei de Benford.\"\nv   <- 1:9\nf   <- round(log10(1+1/v),4)\ndd  <- as.data.frame(t(c('Frequência',f)))\n#colnames(dd) <-c('Frequência',v)\n\nkable(dd,\n      col.names = c(\"Valores\",v\n                    )) %>% \n  kable_styling(full_width = F,\n                bootstrap_options = c(\"striped\",\"hover\",\"condensed\",\"responsive\"))\n```\n\nPodemos representar a @tbl-ben1 como um gráfico de barras (@fig-freqben1).\n\n```{r fig-freqben1, echo=F, fig.cap=\"\"}\n#| Label: fig-freqben1\n#| fig-cap: \"As frequências da lei de Benford.\"\nw  <- 1:9\nf  <- round(log10(1+1/w)*100,2)\nd1 <- data.frame(w,f) \np <- ggplot(d1,aes(x=factor(w), y=f)) +\n  geom_bar(stat = 'identity', \n           colour='black',fill='lightgray') +\n  xlab('Dígitos') +\n  ylab('Frequência (%)') + \n  geom_text(aes(label=f), vjust=-0.3, colour='black', size=3.5)\np\n```\n\nAs probabilidades da @tbl-ben1 e da @fig-freqben1 para o primeiro dígito $d$ ($d \\in \\{1, \\cdots, 9 \\}$), as quais satisfazem a lei de Benford são dadas por\n\n$$ P(d) = log_{10} \\left( 1 + \\frac{1}{d} \\right) $$\n\n```{r}\nw <- 1:9\nround(log10(1+1/w),4)\n```\n\n# Uma breve explicação\n\nA primeira ideia é que os dados que se adequam à lei de Benford tem **crescimento exponencial**, ou seja, algo do tipo\n\n$$\nf(t) = t_0 (1 + r)^t\n$$ {#eq-cresc}\n\nem que, por exemplo, $t$ é o tempo, $t_0$ é o valor de $f(t)$ no tempo 0, e $r$ é a taxa de crescimento.\n\n## Juros compostos\n\nComo um exemplo, vamos trabalhar a ideia de juros compostos, em que o juro incide sobre o capital inicial e sobre os juros acumulados. A expressão para o cálculo de juros compostos tem a mesma estrutura da @eq-cresc, ou seja,\n\n$$ M = C (1 + i)^t $$ em que $M$ é o montante no instante $t$, $C$ é o capital inicial quando $t=0$, e $i$ é a taxa de juros fixa. Observe os dados abaixo. Eles foram obtidos usando um capital inicial de R\\$100,00 com uma taxa de crescimento de 2.5% por período. Observa que, inicialmente, o primeiro dígito significativo igual a 1 aparece nos 28 primeiros valores. Depois, o crescimento é mais rápido e o sistema apresenta 16 valores com o primeiro dígito significativo igual a 2. O crescimento se acentua e o dígito 3 aparece nos próximos 12 valores. Como o capital cresce cada vez mais rápido, os próximos dígitos aparecem cada vez menos. Veja o dígito 9, ele aparece apenas 5 vezes. Logo após, o dígito 1 aparece novamente por mais 28 períodos.\n\n```{r}\n# Juros compostos\nc <- 100\ni <- 0.025\nt <- 1:190\nm <- c*(1+i)^t\nm\n```\n\nVamos agora extrair os primeiros dígitos significativos do nosso conjunto de dados.\n\n```{r}\ndddd <- as.data.frame(m)\naux1 <- c()\nfor (i in 1:dim(dddd)[1]) {\n  n <- as.integer(dddd[i,1])\n  aux2 <- c()\n  while (n > 0) {\n    r = n %% 10\n    aux2 <- c(aux2,r)\n    n = n %/% 10\n  }\n  ll <- aux2[length(aux2)]\n  aux1 <- c(aux1,ll)\n}\n```\n\nObservamos a distribuição de frequências destes valores abaixo.\n\n```{r}\n#\ntt <- table(aux1)\nround(tt/sum(tt),4)\n```\n\nPodemos comparar os dados teóricos apresentados na @tbl-ben1 e na @fig-freqben1 com os dos juros compostos. Isto pode ser visto na @tbl-ben2.\n\n```{r ben2, echo=FALSE,  fig.pos=\"!H\",out.extra = \"\", results='asis', fig.cap=\"\"}\n#| label: tbl-ben2\n#| tbl-cap-location: top\n#| tbl-cap: \"Comparação das frequências teórica da lei de Benford e dos dados de juros compostos.\"\nv   <- 1:9\nf   <- round(log10(1+1/v),4)\nw   <- t(c('Teórico',f))\nt   <- c(table(aux1))\ng   <- t(matrix(c('Exemplo',round(t/sum(t),4))))\nh   <- data.frame(rbind(w,g))\n#colnames(dd) <-c('Frequência',v)\nkable(h,\n      col.names = c(\"Valores\",v\n                    )) %>% \n  kable_styling(full_width = F,\n                bootstrap_options = c(\"striped\",\"hover\",\"condensed\",\"responsive\"))\n```\n\n## Multiplicação de valores (fraudes contábeis)\n\nDados contábeis e econômicos geralmente são o resultado da multiplicação de vários números. Quando temos esse caso, os dados se aproximam da distribuição de Benford. Por isto essa distribuição é usada para identificar fraudes. Se alguém alterar os dados contábeis de um conjunto de dados por meio de fraudes, esse erro poderá se apresentar quando compararmos a frequência dos primeiros dígitos com a distribuição de Benford.\n\nPor exemplo, vamos gerar dados a partir de três distribuições de probabilidades, uma normal (N(200,25)), outra qui-quadrado ($\\chi^2(5)$) e uma uniforme (U(0,1)). Geramos 10 mil valores aleatórios a partir de cada distribuição e alocamos em três coluna, conforme foram gerados.\n\n```{r}\nset.seed(1)\ndn <- rnorm(10000,200,5)\ndp <- rchisq(10000,5)\ndu <- runif(10000,0,1)\nda <- data.frame(dn,dp,du)\nhead(da)\n```\n\nDepois fizemos o produto dos valores dispostos em cada linha do conjunto de dados.\n\n```{r}\nda2 <- data.frame(da,\"dn.dp.du\" = dn*dp*du)\nhead(da2)\n```\n\nAgora vamos obter o primeiro dígito da última coluna dos dados apresentados acima e, então, comparar a frequência deles com a distribuição teórica de Benford.\n\n```{r}\ndt <- dn*dp*du\ndddd <- as.data.frame(dt)\naux1 <- c()\nfor (i in 1:dim(dddd)[1]) {\n  n <- as.integer(dddd[i,1])\n  aux2 <- c()\n  while (n > 0) {\n    r = n %% 10\n    aux2 <- c(aux2,r)\n    n = n %/% 10\n  }\n  ll <- aux2[length(aux2)]\n  aux1 <- c(aux1,ll)\n}\nddt <- aux1\n#\nttt  <- table(ddt)\nreat <- round(ttt/sum(ttt),4)\n#\nx2  <- seq(1,9,0.1)\nteo2 <- round(log10(1+1/x2),4)\n```\n\nNa @fig-freqben4, observamos os dados gerados aleatoriamente (sem fraude), ou seja, a frequência dos primeiros dígitos da coluna que representa o produto da multiplicação dos valores gerados pelas distribuições propostas anteriormente. Estes valores são representados pelos pontos, enquanto que, a distribuição teórica é representada pela curva (linha). É possível notar uma grande concordância entre os pontos e a curva.\n\n```{r fig-freqben4, echo=F, fig.cap=\"\"}\n#| Label: fig-freqben4\n#| fig-cap: \"As frequências da lei de Benford e dados gerados aleatóriamente (sem fraude).\"\npar(mar=c(2.5,2.5,0.5,0.5), mgp=c(1.5,0.5,0))\nplot(teo2~x2,type='l',ylim = c(0,0.33),\n     xlab=\"Dígitos\",\n     ylab = \"Frequência\")\nlines(reat, type = 'p')\n```\n"},"formats":{"html":{"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["styles.css"],"toc":true,"output-file":"benford.html"},"language":{},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.2.335","editor":"visual","theme":"cosmo","title":"Benford","author":"Omar C N Pereira","categories":["R","Lei de Benford","Juros compostos"],"tags":["Benford","Crescimento exponencial","Juros compostos","Fraudes"]},"extensions":{"book":{"multiFile":true}}}}}